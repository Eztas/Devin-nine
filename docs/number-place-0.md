# ナンバープレイスアプリ 設計書(最初期)

## 1. 概要

ユーザーが快適に遊べるナンバープレイスアプリを開発する。主な要件は、初期配置の数字の数を自由に設定できること、入力や思考を補助するハイライト機能、そして自分の力で解けた満足感を得られるよう、正誤判定は最後の一括判定のみとすることである。

本アプリはGitHub Pagesでの公開を想定し、**HTML、CSS、JavaScriptのみ**で完結させる。

---

## 2. 画面構成

本アプリは以下の3つの画面で構成される。

なおページ遷移は行わず、1つのURLで完結させるようにする。
ボタンを押すごとにページは変わらずに、表示内容だけ変えるようにする。

| 画面名 | 説明 |
| :--- | :--- |
| **ホーム画面** | ゲームの難易度（初期配置の数字の数）を設定し、ゲームを開始する。 |
| **ゲーム画面** | 実際にナンプレパズルを解く画面。数字やメモの入力、削除、ハイライト機能を持つ。 |
| **リザルト画面** | 解答の正誤結果を表示し、再挑戦を促す。 |

---

## 3. 画面詳細設計

### 3.1. ホーム画面

**画面イメージ:**
中央にタイトル、難易度設定用のスライダー、そしてゲーム開始ボタンを配置するシンプルな構成。

**コンポーネント定義:**

| コンポーネント | 種別 | 説明 |
| :--- | :--- | :--- |
| タイトル | テキスト | アプリケーションのタイトルを表示する。 |
| 難易度設定 | スライダー | 初期配置する数字の数を設定する。範囲は**17〜80**まで1刻みで選択可能。 |
| 設定数表示 | テキスト | スライダーの現在の値をリアルタイムで表示する。「初期配置の数: 45」のように表示。 |
| ゲーム開始ボタン | ボタン | 「ゲーム開始」と表示。押下するとゲーム画面へ遷移する。 |

**機能要件:**
* スライダーを動かすと、設定数がリアルタイムで更新される。
* 「ゲーム開始」ボタンを押下すると、問題生成処理を開始する。
    * 処理中はボタンを無効化し、テキストを「問題生成中...」に変更して、ユーザーの連続クリックを防ぐ。

### 3.2. ゲーム画面

**画面イメージ:**
画面上部に9x9のナンバープレイス盤、右上に初期配置数を表示。画面下部には数字選択パネル(1-9)、モード切替ボタン、削除ボタン、完成ボタンを配置する。

**コンポーネント定義:**

| コンポーネント | 種別 | 説明 |
| :--- | :--- | :--- |
| ナンバープレイス盤 | 9x9 グリッド | 81個のセルで構成。太線で3x3のブロックを区切る。 |
|   - セル | グリッド内の要素 | 数字またはメモを入力する領域。 |
| 初期配置数表示 | テキスト | ホーム画面で設定した初期配置数を右上に表示する。「ヒント: 45」のように表示。 |
| 数字選択パネル | ボタン(9個) | 1から9までの数字を選択するためのボタン。 |
| モード切替ボタン | ボタン | 「数字入力」と「メモ入力」モードを切り替える。 |
| 削除ボタン | ボタン | 現在選択しているセルの数字またはメモを削除する。 |
| 完成！ボタン | ボタン | 盤面の全ての入力が完了した際に押下。リザルト画面へ遷移する。 |

**機能要件:**
* **セル操作:**
    * 空のセルをタップすると、そのセルが選択状態（例：枠線が青くなる）になる。
    * **初期配置された数字は変更・削除不可**とする。
* **入力モード:**
    * **数字入力モード時:** 数字選択パネルで数字を選んだ後、セルをタップするとその数字が大きく入力される。すでに入力されているメモは全てクリアされる。
    * **メモ入力モード時:** 数字選択パネルで数字を選んだ後、セルをタップすると、その数字がセルの1/9サイズの領域に小さくメモとして入力される。一つのセルに最大9個のメモが可能。
* **削除機能:**
    * 削除ボタンを押下すると、現在選択されているセルのユーザーが入力した数字、またはメモが全て削除される。
* **ハイライト機能:**
    * 数字選択パネルでいずれかの数字（例：「5」）を選択すると、盤面上の同じ数字（初期配置、ユーザー入力問わず）を持つ**セルの背景が黄色系でハイライト**される。
    * 同時に、メモとして入力されている同じ数字（「5」）の**メモマスの背景も黄色系でハイライト**される。

### 3.3. リザルト画面

**画面イメージ:**
中央に「クリア！」または「不正解...」という結果メッセージと、「もう一度遊ぶ」ボタンを配置する。

**コンポーネント定義:**

| コンポーネント | 種別 | 説明 |
| :--- | :--- | :--- |
| 結果メッセージ | テキスト | パズルの正誤判定結果を表示する。 |
| もう一度遊ぶボタン | ボタン | ホーム画面へ戻る。 |

**機能要件:**
* 「もう一度遊ぶ」ボタンを押下すると、ホーム画面に遷移する。

---

## 4. 問題生成ロジック要件

**最優先事項:** ユーザーがホーム画面で設定した**初期配置の数を可能な限り遵守**すること。

**生成方針:**
1.  **唯一解の保証:** 生成される問題の解は、必ず一つでなければならない。
2.  **難易度の許容:** プレイヤーが解く際に、基本的な解法（シングルなど）だけでなく、中級レベルのテクニック（例: X-Wing, Swordfishなど）を必要とする問題の生成を許容する。当てずっぽうが必須となる問題は避ける。

**生成プロセス:**
1.  **完全なナンバープレイス盤の生成:** まず、バックトラッキングなどのアルゴリズムを用いて、数字がすべて埋まった矛盾のないナンバープレイス盤（解答）を一つ作成する。
2.  **マスの削除:**
    * 完成した盤面から、ランダムにマスを一つ選んで数字を消す（0にする）。
    * 数字を消すたびに、その盤面の**解が唯一であるか**をチェックする。
    * もしくは、解が唯一であるかどうかを確認せず、そもそも一意になるように問題を作っていく。
    * もし解が複数になる（または解けなくなる）場合は、そのマスを消すのを取りやめ、数字を元に戻す。
    * 解が唯一であることが確認できた場合のみ、そのマスを空マスのままにする。
3.  **繰り返し:** 上記の「マスの削除」処理を、ユーザーが設定した初期配置の数になるまで繰り返す。
    * もし、どのマスを消しても唯一解を保てなくなった場合は、そこで処理を終了する。このため、最終的なヒント数が設定値より若干多くなる可能性はあるが、設定値を最優先の目標とする。

---

## 5. 技術要件

| 項目 | 内容 |
| :--- | :--- |
| **言語** | HTML, CSS, JavaScript |
| **フレームワーク/ライブラリ** | tailwind CSSのCDN利用 |
| **実行環境** | モダンブラウザ、GitHub Pages |

---

## 6. 備考

* 画面はスマートフォンでの利用を想定した縦型UIに最適化する。
* タスクのリストは完了状態によって並び順は変わらない。
* 入力された数字の重複チェックはリアルタイムでは行わず、「完成！」ボタン押下時に一括で行う。
* ソースコードの可読性を上げるために、ナンバープレイス描画部分とナンバープレイス問題生成ロジックは別ファイルで書くようにして
